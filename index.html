<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC Äiá»u HÃ nh Nhiá»‡m Vá»¥ - KH&CN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        :root {
            --bg-deep: #071028;
            --card-bg: #0f1c3f;
            --border-blue: #1e3a8a;
            --accent-yellow: #facc15;
        }

        body {
            background: var(--bg-deep);
            color: white;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-blue);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0f1c3f;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #1e3a8a;
            border-radius: 10px;
        }

        select, input {
            background: #162a5a;
            color: white;
            border: 1px solid #1e3a8a;
        }

        select:focus, input:focus {
            border-color: var(--accent-yellow);
            outline: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .task-row {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* MÃ u sáº¯c cho tá»«ng cáº¥p Ä‘á»™ tiáº¿n Ä‘á»™ */
        .step-cv { color: #94a3b8; } /* ChuyÃªn viÃªn */
        .step-tp { color: #60a5fa; } /* TrÆ°á»Ÿng phÃ²ng */
        .step-ld { color: #facc15; } /* LÃ£nh Ä‘áº¡o Sá»Ÿ */
        .step-ngoai { color: #f472b6; } /* BÃªn ngoÃ i */
        .step-final { color: #4ade80; } /* HoÃ n thÃ nh */
    </style>
</head>

<body class="p-4 md:p-8">

    <!-- HEADER -->
    <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-yellow-400 uppercase tracking-tight">
                Há»‡ thá»‘ng theo dÃµi nhiá»‡m vá»¥ Sá»Ÿ KH&CN
            </h1>
            <p class="text-blue-300 text-sm mt-1 italic">Theo dÃµi 40 nhiá»‡m vá»¥ & Quy trÃ¬nh phá»‘i há»£p Ä‘a bÃªn</p>
        </div>
        <div class="text-right">
            <span id="currentDate" class="text-xs font-mono text-blue-400 bg-blue-900/30 px-3 py-1 rounded-full border border-blue-800"></span>
        </div>
    </header>

    <!-- KPI ROW -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8" id="kpis"></div>

    <!-- MAIN DASHBOARD -->
    <div class="grid lg:grid-cols-3 gap-8 mb-8">
        <div class="card rounded-2xl p-6 flex flex-col items-center justify-center">
            <h2 class="text-lg mb-8 text-yellow-200 font-semibold w-full text-left uppercase text-sm tracking-wider">Tá»•ng thá»ƒ tiáº¿n Ä‘á»™</h2>
            <div class="relative w-48 h-48 md:w-56 md:h-56">
                <div id="donut" class="w-full h-full rounded-full transition-all duration-1000"></div>
                <div class="absolute inset-0 flex flex-col justify-center items-center bg-transparent">
                    <div id="percent" class="text-4xl font-bold">0%</div>
                    <div class="text-[10px] uppercase tracking-widest text-blue-300">HoÃ n thÃ nh</div>
                </div>
            </div>
            <div class="mt-8 grid grid-cols-1 gap-3 w-full text-xs uppercase font-medium">
                <div class="flex justify-between items-center bg-red-950/30 p-2 rounded">
                    <span>ğŸ”´ ChÆ°a hoÃ n thÃ nh</span>
                    <b id="count-chua" class="text-red-400 text-base">0</b>
                </div>
                <div class="flex justify-between items-center bg-green-950/30 p-2 rounded">
                    <span>ğŸŸ¢ ÄÃ£ hoÃ n thÃ nh</span>
                    <b id="count-xong" class="text-green-400 text-base">0</b>
                </div>
            </div>
        </div>

        <div class="card rounded-2xl p-6 col-span-1 lg:col-span-2">
            <h2 class="text-lg mb-6 text-yellow-200 font-semibold uppercase text-sm tracking-wider">Tiáº¿n Ä‘á»™ theo phÃ²ng chuyÃªn mÃ´n</h2>
            <div id="bars" class="space-y-5 custom-scrollbar max-h-[400px] overflow-y-auto pr-2"></div>
        </div>
    </div>

    <!-- DATA TABLE SECTION -->
    <div class="card rounded-2xl p-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <h2 class="text-lg text-yellow-200 font-semibold uppercase text-sm tracking-wider">Chi tiáº¿t quy trÃ¬nh phÃª duyá»‡t</h2>
            <div class="flex flex-wrap gap-2 w-full md:w-auto">
                <input type="text" id="searchBox" placeholder="TÃ¬m tÃªn nhiá»‡m vá»¥..." class="px-4 py-2 rounded-lg text-sm w-full md:w-64">
                <select id="filterGroup" class="px-4 py-2 rounded-lg text-sm cursor-pointer">
                    <option value="all">Táº¥t cáº£ Ä‘Æ¡n vá»‹</option>
                </select>
            </div>
        </div>

        <div class="overflow-x-auto custom-scrollbar h-[600px]">
            <table class="w-full text-left border-collapse min-w-[1100px]">
                <thead class="sticky top-0 bg-[#0f1c3f] z-10 shadow-lg">
                    <tr class="bg-blue-900/50 text-yellow-400 text-[10px] uppercase tracking-wider">
                        <th class="p-4 font-bold border-b border-blue-800 w-12 text-center">STT</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-28">ÄÆ¡n vá»‹</th>
                        <th class="p-4 font-bold border-b border-blue-800">Ná»™i dung nhiá»‡m vá»¥</th>
                        <th class="p-4 font-bold border-b border-blue-800 text-center w-28">Háº¡n Ä‘á»‹nh</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-56 text-center">Cáº­p nháº­t tiáº¿n Ä‘á»™ (PhÃ¢n quyá»n)</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-32 text-center">Tráº¡ng thÃ¡i</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-sm"></tbody>
            </table>
        </div>
        <div id="noResults" class="hidden text-center py-10 text-gray-500">KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p</div>
    </div>

    <script>
        document.getElementById('currentDate').innerText = "Dá»¯ liá»‡u há»‡ thá»‘ng: " + new Date().toLocaleDateString('vi-VN');

        const tasks = [
            {id: 1, g:"CN&ÄMST", t:"Tham mÆ°u Káº¿ hoáº¡ch thá»±c hiá»‡n Chiáº¿n lÆ°á»£c phÃ¡t triá»ƒn KH,CN vÃ  ÄMST Ä‘áº¿n nÄƒm 2030 (QÄ 569/QÄ-TTg)", d:"2026-01-31", s:"CV"},
            {id: 2, g:"TCÄLCL", t:"Tham mÆ°u xÃ¢y dá»±ng ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng thá»±c hiá»‡n Chá»‰ thá»‹ sá»‘ 38-CT/TW cá»§a Ban BÃ­ thÆ°", d:"2026-01-31", s:"CV"},
            {id: 3, g:"CN&ÄMST", t:"Tham mÆ°u xÃ¢y dá»±ng Nghá»‹ quyáº¿t Äáº£ng bá»™ tá»‰nh vá» Ä‘á»™t phÃ¡ KHCN, ÄMST, CÄS", d:"2026-01-31", s:"CV"},
            {id: 4, g:"CN&ÄMST", t:"Tham mÆ°u xÃ¢y dá»±ng Äá» Ã¡n thÃ nh láº­p Quá»¹ phÃ¡t triá»ƒn KH,CN vÃ  ÄMST tá»‰nh", d:"2026-01-31", s:"CV"},
            {id: 5, g:"TC-KH", t:"BÃ¡o cÃ¡o nhu cáº§u vá»‘n KHCN, ÄMST, CÄS (2026-2030) gá»­i Bá»™ TÃ i chÃ­nh", d:"2026-02-05", s:"CV"},
            {id: 6, g:"VÄƒn phÃ²ng", t:"Tá»•ng há»£p, bÃ¡o cÃ¡o tÃ¬nh hÃ¬nh thá»±c hiá»‡n nhiá»‡m vá»¥ trÆ°á»›c Táº¿t NguyÃªn Ä‘Ã¡n", d:"2026-02-10", s:"CV"},
            {id: 7, g:"QLKH", t:"XÃ¡c Ä‘á»‹nh danh má»¥c nhiá»‡m vá»¥ KH&CN cáº¥p tá»‰nh Ä‘áº·t hÃ ng nÄƒm 2026", d:"2026-02-15", s:"CV"},
            {id: 8, g:"VÄƒn phÃ²ng", t:"Káº¿ hoáº¡ch thanh tra chuyÃªn ngÃ nh vá» tiÃªu chuáº©n Ä‘o lÆ°á»ng cháº¥t lÆ°á»£ng Ä‘á»£t 1", d:"2026-02-20", s:"CV"},
            {id: 9, g:"TCÄLCL", t:"HÆ°á»›ng dáº«n cÃ¡c doanh nghiá»‡p Ä‘Äƒng kÃ½ giáº£i thÆ°á»Ÿng Cháº¥t lÆ°á»£ng Quá»‘c gia", d:"2026-02-20", s:"CV"},
            {id: 10, g:"CN&ÄMST", t:"Tá»• chá»©c Há»™i Ä‘á»“ng tÆ° váº¥n giao trá»±c tiáº¿p tá»• chá»©c chá»§ trÃ¬ nhiá»‡m vá»¥ KHCN", d:"2026-02-25", s:"CV"},
            {id: 11, g:"QLKH", t:"BÃ¡o cÃ¡o tÃ¬nh hÃ¬nh á»©ng dá»¥ng káº¿t quáº£ Ä‘á» tÃ i sau nghiá»‡m thu", d:"2026-02-28", s:"CV"},
            {id: 12, g:"VÄƒn phÃ²ng", t:"Tá»• chá»©c Há»™i nghá»‹ cÃ¡n bá»™ cÃ´ng chá»©c, viÃªn chá»©c Ä‘áº§u nÄƒm", d:"2026-02-28", s:"CV"},
            {id: 13, g:"TC-KH", t:"CÃ´ng khai dá»± toÃ¡n ngÃ¢n sÃ¡ch nhÃ  nÆ°á»›c nÄƒm 2026", d:"2026-03-01", s:"CV"},
            {id: 14, g:"CÄS", t:"Triá»ƒn khai cáº­p nháº­t cÆ¡ sá»Ÿ dá»¯ liá»‡u quá»‘c gia vá» KH&CN", d:"2026-03-05", s:"CV"},
            {id: 15, g:"VÄƒn phÃ²ng", t:"Kiá»ƒm tra viá»‡c cháº¥p hÃ nh quy Ä‘á»‹nh phÃ¡p luáº­t vá» an toÃ n bá»©c xáº¡ háº¡t nhÃ¢n", d:"2026-03-10", s:"CV"},
            {id: 16, g:"TCÄLCL", t:"Kiá»ƒm Ä‘á»‹nh phÆ°Æ¡ng tiá»‡n Ä‘o nhÃ³m 2 táº¡i cÃ¡c chá»£, trung tÃ¢m thÆ°Æ¡ng máº¡i", d:"2026-03-15", s:"CV"},
            {id: 17, g:"CN&ÄMST", t:"XÃ¢y dá»±ng káº¿ hoáº¡ch há»— trá»£ há»‡ sinh thÃ¡i khá»Ÿi nghiá»‡p Ä‘á»•i má»›i sÃ¡ng táº¡o", d:"2026-03-20", s:"CV"},
            {id: 18, g:"QLKH", t:"Tá»• chá»©c nghiá»‡m thu cÃ¡c Ä‘á» tÃ i KHCN cáº¥p cÆ¡ sá»Ÿ Ä‘á»£t 1", d:"2026-03-25", s:"CV"},
            {id: 19, g:"VÄƒn phÃ²ng", t:"BÃ¡o cÃ¡o káº¿t quáº£ thá»±c hiá»‡n cÃ´ng tÃ¡c cáº£i cÃ¡ch hÃ nh chÃ­nh QuÃ½ I", d:"2026-03-25", s:"CV"},
            {id: 20, g:"CÄS", t:"ÄÃ¡nh giÃ¡ má»©c Ä‘á»™ an toÃ n thÃ´ng tin máº¡ng trong cÆ¡ quan", d:"2026-03-30", s:"CV"},
            {id: 21, g:"QLKH", t:"PhÃª duyá»‡t thuyáº¿t minh Ä‘á» tÃ i KHCN cáº¥p tá»‰nh thá»±c hiá»‡n tá»« nÄƒm 2026", d:"2026-03-31", s:"CV"},
            {id: 22, g:"TCÄLCL", t:"Tá»•ng káº¿t chÆ°Æ¡ng trÃ¬nh Ä‘áº£m báº£o Ä‘o lÆ°á»ng táº¡i doanh nghiá»‡p", d:"2026-03-31", s:"CV"},
            {id: 23, g:"CN&ÄMST", t:"PhÃ¡t Ä‘á»™ng cuá»™c thi Khá»Ÿi nghiá»‡p Ä‘á»•i má»›i sÃ¡ng táº¡o tá»‰nh nÄƒm 2026", d:"2026-04-01", s:"CV"},
            {id: 24, g:"TC-KH", t:"BÃ¡o cÃ¡o tÃ¬nh hÃ¬nh giáº£i ngÃ¢n vá»‘n Ä‘áº§u tÆ° cÃ´ng QuÃ½ I/2026", d:"2026-04-05", s:"CV"},
            {id: 25, g:"VÄƒn phÃ²ng", t:"Tiáº¿p cÃ´ng dÃ¢n Ä‘á»‹nh ká»³ vÃ  giáº£i quyáº¿t khiáº¿u náº¡i tá»‘ cÃ¡o", d:"2026-04-10", s:"CV"},
            {id: 26, g:"VÄƒn phÃ²ng", t:"Káº¿ hoáº¡ch tá»• chá»©c cÃ¡c hoáº¡t Ä‘á»™ng chÃ o má»«ng ngÃ y KH&CN Viá»‡t Nam 18/5", d:"2026-04-15", s:"CV"},
            {id: 27, g:"QLKH", t:"Kiá»ƒm tra tiáº¿n Ä‘á»™ thá»±c hiá»‡n cÃ¡c Ä‘á» tÃ i, dá»± Ã¡n chuyá»ƒn tiáº¿p", d:"2026-04-20", s:"CV"},
            {id: 28, g:"TCÄLCL", t:"Tá»• chá»©c táº­p huáº¥n nghiá»‡p vá»¥ vá» TiÃªu chuáº©n Äo lÆ°á»ng Cháº¥t lÆ°á»£ng", d:"2026-04-25", s:"CV"},
            {id: 29, g:"CÄS", t:"Táº¡o láº­p sá»• quáº£n lÃ½ vÄƒn báº£n Ä‘i, Ä‘áº¿n trong cÃ´ng tÃ¡c vÄƒn thÆ° trÃªn há»‡ thá»‘ng VBDH", d:"2026-02-13", s:"CV"},
            {id: 30, g:"VÄƒn phÃ²ng", t:"Tham gia thá»±c hiá»‡n cháº¿ Ä‘á»™ bÃ¡o cÃ¡o Táº¿t", d:"2026-02-22", s:"CV"},
            {id: 31, g:"CÄS", t:"Tham mÆ°u triá»ƒn khai Káº¿ hoáº¡ch 04-KH/BCÄTW vá» KH,CN, ÄMST vÃ  CÄS", d:"2026-02-24", s:"CV"},
            {id: 32, g:"VÄƒn phÃ²ng", t:"Káº¿ hoáº¡ch kiá»ƒm soÃ¡t TTHC, thá»±c hiá»‡n cÆ¡ cháº¿ má»™t cá»­a nÄƒm 2026", d:"2026-02-26", s:"CV"},
            {id: 33, g:"TC-KH", t:"PhÆ°Æ¡ng Ã¡n sáº¯p xáº¿p sá»Ÿ há»¯u, tÃ i sáº£n cÃ´ng nghiá»‡p sau sáº¯p xáº¿p", d:"2026-02-28", s:"CV"},
            {id: 34, g:"VÄƒn phÃ²ng", t:"RÃ  soÃ¡t, Ä‘iá»u chá»‰nh Nghá»‹ quyáº¿t, ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng (Äáº¡i há»™i XIV)", d:"2026-03-31", s:"CV"},
            {id: 35, g:"VÄƒn phÃ²ng", t:"Äiá»u chá»‰nh, bá»• sung Quyáº¿t Ä‘á»‹nh cá»§a Sá»Ÿ nÄƒm 2026", d:"2026-03-31", s:"CV"},
            {id: 36, g:"VÄƒn phÃ²ng", t:"Chá»‰ Ä‘áº¡o nhÃ  máº¡ng tuyÃªn truyá»n vá» phÃ²ng chÃ¡y chá»¯a chÃ¡y táº­p trung", d:"2026-03-31", s:"CV"},
            {id: 37, g:"VÄƒn phÃ²ng", t:"BÃ¡o cÃ¡o cÃ´ng tÃ¡c thanh tra QuÃ½ I/2026", d:"2026-03-20", s:"CV"},
            {id: 38, g:"CN&ÄMST", t:"Äá» xuáº¥t Ä‘áº·t hÃ ng nhiá»‡m vá»¥ thuá»™c ChÆ°Æ¡ng trÃ¬nh nÃ´ng thÃ´n miá»n nÃºi", d:"2026-03-25", s:"CV"},
            {id: 39, g:"QLKH", t:"Há»p Há»™i Ä‘á»“ng KHCN tá»‰nh phiÃªn thá»© nháº¥t nÄƒm 2026", d:"2026-03-30", s:"CV"},
            {id: 40, g:"CÄS", t:"BÃ¡o cÃ¡o káº¿t quáº£ chuyá»ƒn Ä‘á»•i sá»‘ 3 thÃ¡ng Ä‘áº§u nÄƒm 2026", d:"2026-03-31", s:"CV"}
        ];

        const steps = [
            {id: "CV", label: "ChuyÃªn viÃªn Ä‘ang thá»±c hiá»‡n", class: "step-cv"},
            {id: "TP", label: "TrÆ°á»Ÿng phÃ²ng Ä‘ang duyá»‡t", class: "step-tp"},
            {id: "PGD", label: "PhÃ³ GiÃ¡m Ä‘á»‘c Ä‘ang duyá»‡t", class: "step-ld"},
            {id: "GD", label: "GiÃ¡m Ä‘á»‘c Ä‘ang duyá»‡t", class: "step-ld"},
            {id: "GOP_Y", label: "Äang gá»­i gÃ³p Ã½ Sá»Ÿ, NgÃ nh", class: "step-ngoai"},
            {id: "VP_UB", label: "VP UBND tá»‰nh Ä‘ang xá»­ lÃ½", class: "step-ngoai"},
            {id: "VP_HD", label: "VP HÄND-QH Ä‘ang xá»­ lÃ½", class: "step-ngoai"},
            {id: "VP_TU", label: "VP Tá»‰nh á»§y Ä‘ang xá»­ lÃ½", class: "step-ngoai"},
            {id: "DONE", label: "ÄÃ£ hoÃ n thÃ nh/Ban hÃ nh", class: "step-final"}
        ];

        function getTaskStep(id, defaultVal) {
            return localStorage.getItem('task_step_v4_' + id) || defaultVal;
        }

        function updateTaskStep(id, newStep) {
            localStorage.setItem('task_step_v4_' + id, newStep);
            render();
        }

        function getDeadlineStatus(dateStr, stepId) {
            if (stepId === "DONE") return { label: "HoÃ n thÃ nh", color: "bg-green-500/20 text-green-400 border border-green-500/50" };
            const deadline = new Date(dateStr);
            const today = new Date();
            today.setHours(0,0,0,0);
            if (deadline < today) return { label: "QuÃ¡ háº¡n", color: "bg-red-500/20 text-red-400 border border-red-500/50" };
            const diffDays = Math.ceil(Math.abs(deadline - today) / (1000 * 60 * 60 * 24)); 
            if (diffDays <= 5) return { label: "Sáº¯p Ä‘áº¿n háº¡n", color: "bg-yellow-500/20 text-yellow-400 border border-yellow-500/50" };
            return { label: "Trong háº¡n", color: "bg-blue-500/20 text-blue-400 border border-blue-500/50" };
        }

        const units = [...new Set(tasks.map(t => t.g))].sort();
        const filterSelect = document.getElementById('filterGroup');
        units.forEach(unit => {
            const opt = document.createElement('option');
            opt.value = unit;
            opt.innerText = unit;
            filterSelect.appendChild(opt);
        });

        document.getElementById('searchBox').addEventListener('input', render);
        document.getElementById('filterGroup').addEventListener('change', render);

        function render() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const groupFilter = document.getElementById('filterGroup').value;
            let totalTasks = tasks.length;
            let countXong = 0;
            let sourceStats = {};

            const filteredTasks = tasks.filter(t => {
                const stepId = getTaskStep(t.id, t.s);
                if (stepId === "DONE") countXong++;
                
                if (!sourceStats[t.g]) sourceStats[t.g] = { total: 0, done: 0 };
                sourceStats[t.g].total++;
                if (stepId === "DONE") sourceStats[t.g].done++;
                
                return t.t.toLowerCase().includes(search) && (groupFilter === "all" || t.g === groupFilter);
            });

            document.getElementById('kpis').innerHTML = `
                <div class="card p-4 rounded-xl border-l-4 border-l-blue-500"><div class="text-[10px] text-blue-300 uppercase font-bold">Tá»•ng nhiá»‡m vá»¥</div><div class="text-2xl font-bold mt-1">${totalTasks}</div></div>
                <div class="card p-4 rounded-xl border-l-4 border-l-red-500"><div class="text-[10px] text-red-400 uppercase font-bold">ChÆ°a hoÃ n thÃ nh</div><div class="text-2xl font-bold mt-1">${totalTasks - countXong}</div></div>
                <div class="card p-4 rounded-xl border-l-4 border-l-green-500"><div class="text-[10px] text-green-400 uppercase font-bold">ÄÃ£ hoÃ n thÃ nh</div><div class="text-2xl font-bold mt-1">${countXong}</div></div>
                <div class="card p-4 rounded-xl border-l-4 border-l-yellow-500"><div class="text-[10px] text-yellow-400 uppercase font-bold">Tá»· lá»‡ hoÃ n thÃ nh</div><div class="text-2xl font-bold mt-1">${Math.round((countXong/totalTasks)*100)}%</div></div>
            `;

            const pDone = (countXong / totalTasks) * 100;
            document.getElementById('donut').style.background = `conic-gradient(#22c55e 0% ${pDone}%, #1e3a8a ${pDone}% 100%)`;
            document.getElementById('percent').innerText = Math.round(pDone) + "%";
            document.getElementById('count-chua').innerText = totalTasks - countXong;
            document.getElementById('count-xong').innerText = countXong;

            let barsHTML = "";
            Object.keys(sourceStats).sort().forEach(unit => {
                const stat = sourceStats[unit];
                const pct = Math.round((stat.done / stat.total) * 100) || 0;
                barsHTML += `<div><div class="flex justify-between text-xs mb-1 font-semibold"><span>${unit}</span><span class="text-blue-300">${stat.done}/${stat.total}</span></div><div class="w-full bg-blue-900/40 h-2 rounded-full overflow-hidden"><div class="bg-gradient-to-r from-blue-500 to-green-400 h-full transition-all" style="width: ${pct}%"></div></div></div>`;
            });
            document.getElementById('bars').innerHTML = barsHTML;

            let tableHTML = "";
            filteredTasks.forEach((task, index) => {
                const currentStepId = getTaskStep(task.id, task.s);
                const st = getDeadlineStatus(task.d, currentStepId);
                const dateObj = new Date(task.d);
                const dateDisplay = isNaN(dateObj) ? task.d : `${dateObj.getDate().toString().padStart(2,'0')}/${(dateObj.getMonth()+1).toString().padStart(2,'0')}/${dateObj.getFullYear()}`;
                
                tableHTML += `
                    <tr class="task-row border-b border-blue-900/50 hover:bg-blue-800/20 transition-colors" style="animation-delay: ${index * 0.01}s">
                        <td class="p-4 text-center text-blue-400 text-xs font-mono">${task.id}</td>
                        <td class="p-4 font-semibold text-blue-200 text-[11px]">${task.g}</td>
                        <td class="p-4 leading-relaxed text-[13px]">${task.t}</td>
                        <td class="p-4 text-center text-xs font-mono text-blue-300">${dateDisplay}</td>
                        <td class="p-4 text-center">
                            <select onchange="updateTaskStep(${task.id}, this.value)" class="text-[11px] font-medium p-2 rounded cursor-pointer w-full bg-[#162a5a] border border-blue-700 focus:border-yellow-400">
                                ${steps.map(s => `<option value="${s.id}" ${currentStepId === s.id ? 'selected' : ''} class="${s.class}">${s.label}</option>`).join('')}
                            </select>
                        </td>
                        <td class="p-4 text-center"><span class="px-2 py-1 rounded-full text-[9px] font-bold uppercase ${st.color} block text-center min-w-[80px]">${st.label}</span></td>
                    </tr>`;
            });
            document.getElementById('tableBody').innerHTML = tableHTML;
            document.getElementById('noResults').classList.toggle('hidden', filteredTasks.length > 0);
        }
        window.onload = render;
    </script>
</body>
</html>
