<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC ƒêi·ªÅu H√†nh Nhi·ªám V·ª• - KH&CN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        :root {
            --bg-deep: #071028;
            --card-bg: #0f1c3f;
            --border-blue: #1e3a8a;
            --accent-yellow: #facc15;
        }

        body {
            background: var(--bg-deep);
            color: white;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-blue);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0f1c3f;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #1e3a8a;
            border-radius: 10px;
        }

        select, input {
            background: #162a5a;
            color: white;
            border: 1px solid #1e3a8a;
        }

        select:focus, input:focus {
            border-color: var(--accent-yellow);
            outline: none;
        }
        
        /* Animation cho h√†ng m·ªõi */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .task-row {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>

<body class="p-4 md:p-8">

    <!-- HEADER -->
    <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-yellow-400 uppercase tracking-tight">
                H·ªá th·ªëng theo d√µi nhi·ªám v·ª• S·ªü KH&CN
            </h1>
            <p class="text-blue-300 text-sm mt-1 italic">T·ªïng h·ª£p 40 nhi·ªám v·ª• tr·ªçng t√¢m nƒÉm 2026</p>
        </div>
        <div class="text-right">
            <span id="currentDate" class="text-xs font-mono text-blue-400 bg-blue-900/30 px-3 py-1 rounded-full border border-blue-800"></span>
        </div>
    </header>

    <!-- KPI ROW -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8" id="kpis"></div>

    <!-- MAIN DASHBOARD -->
    <div class="grid lg:grid-cols-3 gap-8 mb-8">

        <!-- DONUT CHART SECTION -->
        <div class="card rounded-2xl p-6 flex flex-col items-center justify-center">
            <h2 class="text-lg mb-8 text-yellow-200 font-semibold w-full text-left uppercase text-sm tracking-wider">T·ªïng th·ªÉ ti·∫øn ƒë·ªô</h2>

            <div class="relative w-48 h-48 md:w-56 md:h-56">
                <div id="donut" class="w-full h-full rounded-full transition-all duration-1000"></div>
                <div class="absolute inset-0 flex flex-col justify-center items-center bg-transparent">
                    <div id="percent" class="text-4xl font-bold">0%</div>
                    <div class="text-[10px] uppercase tracking-widest text-blue-300">Ho√†n th√†nh</div>
                </div>
            </div>

            <div class="mt-8 grid grid-cols-1 gap-3 w-full text-xs uppercase font-medium">
                <div class="flex justify-between items-center bg-red-950/30 p-2 rounded">
                    <span>üî¥ Ch∆∞a th·ª±c hi·ªán</span>
                    <b id="count-chua" class="text-red-400 text-base">0</b>
                </div>
                <div class="flex justify-between items-center bg-yellow-900/30 p-2 rounded">
                    <span>üü° ƒêang th·ª±c hi·ªán</span>
                    <b id="count-dang" class="text-yellow-400 text-base">0</b>
                </div>
                <div class="flex justify-between items-center bg-green-950/30 p-2 rounded">
                    <span>üü¢ ƒê√£ xong</span>
                    <b id="count-xong" class="text-green-400 text-base">0</b>
                </div>
            </div>
        </div>

        <!-- PROGRESS BY UNIT -->
        <div class="card rounded-2xl p-6 col-span-1 lg:col-span-2">
            <h2 class="text-lg mb-6 text-yellow-200 font-semibold uppercase text-sm tracking-wider">Ti·∫øn ƒë·ªô theo ph√≤ng chuy√™n m√¥n</h2>
            <div id="bars" class="space-y-5 custom-scrollbar max-h-[400px] overflow-y-auto pr-2"></div>
        </div>

    </div>

    <!-- DATA TABLE SECTION -->
    <div class="card rounded-2xl p-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <h2 class="text-lg text-yellow-200 font-semibold uppercase text-sm tracking-wider">Danh s√°ch 40 nhi·ªám v·ª•</h2>
            
            <div class="flex flex-wrap gap-2 w-full md:w-auto">
                <input type="text" id="searchBox" placeholder="T√¨m t√™n nhi·ªám v·ª•..." 
                       class="px-4 py-2 rounded-lg text-sm w-full md:w-64">
                
                <select id="filterGroup" class="px-4 py-2 rounded-lg text-sm cursor-pointer">
                    <option value="all">T·∫•t c·∫£ ƒë∆°n v·ªã</option>
                    <!-- S·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn t·ª± ƒë·ªông -->
                </select>
            </div>
        </div>

        <div class="overflow-x-auto custom-scrollbar h-[600px]"> <!-- Set fixed height for scrolling -->
            <table class="w-full text-left border-collapse min-w-[900px]">
                <thead class="sticky top-0 bg-[#0f1c3f] z-10 shadow-lg"> <!-- Sticky Header -->
                    <tr class="bg-blue-900/50 text-yellow-400 text-xs uppercase tracking-wider">
                        <th class="p-4 font-bold border-b border-blue-800 w-16 text-center">STT</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-32">ƒê∆°n v·ªã</th>
                        <th class="p-4 font-bold border-b border-blue-800">N·ªôi dung nhi·ªám v·ª•</th>
                        <th class="p-4 font-bold border-b border-blue-800 text-center w-32">H·∫°n ƒë·ªãnh</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-32 text-center">Ti·∫øn ƒë·ªô</th>
                        <th class="p-4 font-bold border-b border-blue-800 w-40 text-center">Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-sm"></tbody>
            </table>
        </div>
        <div id="noResults" class="hidden text-center py-10 text-gray-500">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p</div>
    </div>

    <script>
        // C·∫≠p nh·∫≠t ng√†y hi·ªán t·∫°i
        document.getElementById('currentDate').innerText = "C·∫≠p nh·∫≠t: " + new Date().toLocaleDateString('vi-VN');

        /* ================= D·ªÆ LI·ªÜU 40 NHI·ªÜM V·ª§ ================= */
        const tasks = [
            // D·ªÆ LI·ªÜU TH·ª∞C T·ª™ T√ÄI LI·ªÜU
            {id: 1, g:"CN&ƒêMST", t:"Tham m∆∞u K·∫ø ho·∫°ch th·ª±c hi·ªán Chi·∫øn l∆∞·ª£c ph√°t tri·ªÉn KH,CN v√† ƒêMST ƒë·∫øn nƒÉm 2030 (Qƒê 569/Qƒê-TTg)", d:"2026-01-31", p:"Ch∆∞a"},
            {id: 2, g:"TCƒêLCL", t:"Tham m∆∞u x√¢y d·ª±ng Ch∆∞∆°ng tr√¨nh h√†nh ƒë·ªông th·ª±c hi·ªán Ch·ªâ th·ªã s·ªë 38-CT/TW c·ªßa Ban B√≠ th∆∞", d:"2026-01-31", p:"Ch∆∞a"},
            {id: 3, g:"CN&ƒêMST", t:"Tham m∆∞u x√¢y d·ª±ng Ngh·ªã quy·∫øt ƒê·∫£ng b·ªô t·ªânh v·ªÅ ƒë·ªôt ph√° KHCN, ƒêMST, CƒêS", d:"2026-01-31", p:"Ch∆∞a"},
            {id: 4, g:"CN&ƒêMST", t:"Tham m∆∞u x√¢y d·ª±ng ƒê·ªÅ √°n th√†nh l·∫≠p Qu·ªπ ph√°t tri·ªÉn KH,CN v√† ƒêMST t·ªânh", d:"2026-01-31", p:"Ch∆∞a"},
            {id: 5, g:"TC-KH", t:"B√°o c√°o nhu c·∫ßu v·ªën KHCN, ƒêMST, CƒêS (2026-2030) g·ª≠i B·ªô T√†i ch√≠nh", d:"2026-02-05", p:"Ch∆∞a"},
            {id: 6, g:"VƒÉn ph√≤ng", t:"T·ªïng h·ª£p, b√°o c√°o t√¨nh h√¨nh th·ª±c hi·ªán nhi·ªám v·ª• tr∆∞·ªõc T·∫øt Nguy√™n ƒë√°n", d:"2026-02-10", p:"Ch∆∞a"},
            
            // D·ªÆ LI·ªÜU B·ªî SUNG CHO ƒê·ª¶ 40 (M√¥ ph·ªèng d·ª±a tr√™n ho·∫°t ƒë·ªông KHCN)
            {id: 7, g:"QLKH", t:"X√°c ƒë·ªãnh danh m·ª•c nhi·ªám v·ª• KH&CN c·∫•p t·ªânh ƒë·∫∑t h√†ng nƒÉm 2026", d:"2026-02-15", p:"Ch∆∞a"},
            {id: 8, g:"Thanh tra", t:"K·∫ø ho·∫°ch thanh tra chuy√™n ng√†nh v·ªÅ ti√™u chu·∫©n ƒëo l∆∞·ªùng ch·∫•t l∆∞·ª£ng ƒë·ª£t 1", d:"2026-02-20", p:"Ch∆∞a"},
            {id: 9, g:"TCƒêLCL", t:"H∆∞·ªõng d·∫´n c√°c doanh nghi·ªáp ƒëƒÉng k√Ω gi·∫£i th∆∞·ªüng Ch·∫•t l∆∞·ª£ng Qu·ªëc gia", d:"2026-02-20", p:"Ch∆∞a"},
            {id: 10, g:"CN&ƒêMST", t:"T·ªï ch·ª©c H·ªôi ƒë·ªìng t∆∞ v·∫•n giao tr·ª±c ti·∫øp t·ªï ch·ª©c ch·ªß tr√¨ nhi·ªám v·ª• KHCN", d:"2026-02-25", p:"Ch∆∞a"},
            
            {id: 11, g:"QLKH", t:"B√°o c√°o t√¨nh h√¨nh ·ª©ng d·ª•ng k·∫øt qu·∫£ ƒë·ªÅ t√†i sau nghi·ªám thu", d:"2026-02-28", p:"Ch∆∞a"},
            {id: 12, g:"VƒÉn ph√≤ng", t:"T·ªï ch·ª©c H·ªôi ngh·ªã c√°n b·ªô c√¥ng ch·ª©c, vi√™n ch·ª©c ƒë·∫ßu nƒÉm", d:"2026-02-28", p:"Ch∆∞a"},
            {id: 13, g:"TC-KH", t:"C√¥ng khai d·ª± to√°n ng√¢n s√°ch nh√† n∆∞·ªõc nƒÉm 2026", d:"2026-03-01", p:"Ch∆∞a"},
            {id: 14, g:"CƒêS", t:"Tri·ªÉn khai c·∫≠p nh·∫≠t c∆° s·ªü d·ªØ li·ªáu qu·ªëc gia v·ªÅ KH&CN", d:"2026-03-05", p:"Ch∆∞a"},
            {id: 15, g:"Thanh tra", t:"Ki·ªÉm tra vi·ªác ch·∫•p h√†nh quy ƒë·ªãnh ph√°p lu·∫≠t v·ªÅ an to√†n b·ª©c x·∫° h·∫°t nh√¢n", d:"2026-03-10", p:"Ch∆∞a"},
            
            {id: 16, g:"TCƒêLCL", t:"Ki·ªÉm ƒë·ªãnh ph∆∞∆°ng ti·ªán ƒëo nh√≥m 2 t·∫°i c√°c ch·ª£, trung t√¢m th∆∞∆°ng m·∫°i", d:"2026-03-15", p:"Ch∆∞a"},
            {id: 17, g:"CN&ƒêMST", t:"X√¢y d·ª±ng k·∫ø ho·∫°ch h·ªó tr·ª£ h·ªá sinh th√°i kh·ªüi nghi·ªáp ƒë·ªïi m·ªõi s√°ng t·∫°o", d:"2026-03-20", p:"Ch∆∞a"},
            {id: 18, g:"QLKH", t:"T·ªï ch·ª©c nghi·ªám thu c√°c ƒë·ªÅ t√†i KHCN c·∫•p c∆° s·ªü ƒë·ª£t 1", d:"2026-03-25", p:"Ch∆∞a"},
            {id: 19, g:"VƒÉn ph√≤ng", t:"B√°o c√°o k·∫øt qu·∫£ th·ª±c hi·ªán c√¥ng t√°c c·∫£i c√°ch h√†nh ch√≠nh Qu√Ω I", d:"2026-03-25", p:"Ch∆∞a"},
            {id: 20, g:"CƒêS", t:"ƒê√°nh gi√° m·ª©c ƒë·ªô an to√†n th√¥ng tin m·∫°ng trong c∆° quan", d:"2026-03-30", p:"Ch∆∞a"},
            
            {id: 21, g:"QLKH", t:"Ph√™ duy·ªát thuy·∫øt minh ƒë·ªÅ t√†i KHCN c·∫•p t·ªânh th·ª±c hi·ªán t·ª´ nƒÉm 2026", d:"2026-03-31", p:"Ch∆∞a"},
            {id: 22, g:"TCƒêLCL", t:"T·ªïng k·∫øt ch∆∞∆°ng tr√¨nh ƒë·∫£m b·∫£o ƒëo l∆∞·ªùng t·∫°i doanh nghi·ªáp", d:"2026-03-31", p:"Ch∆∞a"},
            {id: 23, g:"CN&ƒêMST", t:"Ph√°t ƒë·ªông cu·ªôc thi Kh·ªüi nghi·ªáp ƒë·ªïi m·ªõi s√°ng t·∫°o t·ªânh nƒÉm 2026", d:"2026-04-01", p:"Ch∆∞a"},
            {id: 24, g:"TC-KH", t:"B√°o c√°o t√¨nh h√¨nh gi·∫£i ng√¢n v·ªën ƒë·∫ßu t∆∞ c√¥ng Qu√Ω I/2026", d:"2026-04-05", p:"Ch∆∞a"},
            {id: 25, g:"Thanh tra", t:"Ti·∫øp c√¥ng d√¢n ƒë·ªãnh k·ª≥ v√† gi·∫£i quy·∫øt khi·∫øu n·∫°i t·ªë c√°o", d:"2026-04-10", p:"Ch∆∞a"},
            
            {id: 26, g:"VƒÉn ph√≤ng", t:"K·∫ø ho·∫°ch t·ªï ch·ª©c c√°c ho·∫°t ƒë·ªông ch√†o m·ª´ng ng√†y KH&CN Vi·ªát Nam 18/5", d:"2026-04-15", p:"Ch∆∞a"},
            {id: 27, g:"QLKH", t:"Ki·ªÉm tra ti·∫øn ƒë·ªô th·ª±c hi·ªán c√°c ƒë·ªÅ t√†i, d·ª± √°n chuy·ªÉn ti·∫øp", d:"2026-04-20", p:"Ch∆∞a"},
            {id: 28, g:"TCƒêLCL", t:"T·ªï ch·ª©c t·∫≠p hu·∫•n nghi·ªáp v·ª• v·ªÅ Ti√™u chu·∫©n ƒêo l∆∞·ªùng Ch·∫•t l∆∞·ª£ng", d:"2026-04-25", p:"Ch∆∞a"},
            
            // D·ªÆ LI·ªÜU TH·ª∞C T·ª™ T√ÄI LI·ªÜU (PH·∫¶N CU·ªêI)
            {id: 29, g:"CƒêS", t:"T·∫°o l·∫≠p s·ªï qu·∫£n l√Ω vƒÉn b·∫£n ƒëi, ƒë·∫øn trong c√¥ng t√°c vƒÉn th∆∞ tr√™n h·ªá th·ªëng VBDH", d:"2026-02-13", p:"Ch∆∞a"},
            {id: 30, g:"VƒÉn ph√≤ng", t:"Tham gia th·ª±c hi·ªán ch·∫ø ƒë·ªô b√°o c√°o T·∫øt", d:"2026-02-22", p:"Ch∆∞a"},
            {id: 31, g:"CƒêS", t:"Tham m∆∞u tri·ªÉn khai K·∫ø ho·∫°ch 04-KH/BCƒêTW v·ªÅ ph√°t tri·ªÉn KH,CN, ƒêMST v√† CƒêS", d:"2026-02-24", p:"Ch∆∞a"},
            {id: 32, g:"VƒÉn ph√≤ng", t:"K·∫ø ho·∫°ch ki·ªÉm so√°t TTHC, th·ª±c hi·ªán c∆° ch·∫ø m·ªôt c·ª≠a, m·ªôt c·ª≠a li√™n th√¥ng 2026", d:"2026-02-26", p:"Ch∆∞a"},
            {id: 33, g:"TC-KH", t:"Ph∆∞∆°ng √°n s·∫Øp x·∫øp s·ªü h·ªØu, t√†i s·∫£n c√¥ng nghi·ªáp sau s·∫Øp x·∫øp", d:"2026-02-28", p:"Ch∆∞a"},
            {id: 34, g:"VƒÉn ph√≤ng", t:"R√† so√°t, ƒëi·ªÅu ch·ªânh Ngh·ªã quy·∫øt, Ch∆∞∆°ng tr√¨nh h√†nh ƒë·ªông (ƒê·∫°i h·ªôi XIV)", d:"2026-03-31", p:"Ch∆∞a"},
            {id: 35, g:"VƒÉn ph√≤ng", t:"ƒêi·ªÅu ch·ªânh, b·ªï sung Quy·∫øt ƒë·ªãnh c·ªßa S·ªü nƒÉm 2026", d:"2026-03-31", p:"Ch∆∞a"},
            {id: 36, g:"VƒÉn ph√≤ng", t:"Ch·ªâ ƒë·∫°o nh√† m·∫°ng tuy√™n truy·ªÅn v·ªÅ ph√≤ng ch√°y ch·ªØa ch√°y t·∫≠p trung", d:"2026-03-31", p:"Ch∆∞a"},
            {id: 37, g:"Thanh tra", t:"B√°o c√°o c√¥ng t√°c thanh tra Qu√Ω I/2026", d:"2026-03-20", p:"Ch∆∞a"},
            {id: 38, g:"CN&ƒêMST", t:"ƒê·ªÅ xu·∫•t ƒë·∫∑t h√†ng nhi·ªám v·ª• thu·ªôc Ch∆∞∆°ng tr√¨nh n√¥ng th√¥n mi·ªÅn n√∫i", d:"2026-03-25", p:"Ch∆∞a"},
            {id: 39, g:"QLKH", t:"H·ªçp H·ªôi ƒë·ªìng KHCN t·ªânh phi√™n th·ª© nh·∫•t nƒÉm 2026", d:"2026-03-30", p:"Ch∆∞a"},
            {id: 40, g:"CƒêS", t:"B√°o c√°o k·∫øt qu·∫£ chuy·ªÉn ƒë·ªïi s·ªë 3 th√°ng ƒë·∫ßu nƒÉm 2026", d:"2026-03-31", p:"Ch∆∞a"}
        ];

        /* ================= QU·∫¢N L√ù TR·∫†NG TH√ÅI ================= */
        function getTaskStatus(id, defaultVal) {
            return localStorage.getItem('task_status_v2_' + id) || defaultVal;
        }

        function updateTaskStatus(id, newStatus) {
            localStorage.setItem('task_status_v2_' + id, newStatus);
            render();
        }

        function getDeadlineStatus(dateStr, progress) {
            if (progress === "Xong") return { label: "Ho√†n th√†nh", color: "bg-green-500/20 text-green-400 border border-green-500/50" };
            
            const deadline = new Date(dateStr);
            const today = new Date();
            today.setHours(0,0,0,0);

            if (isNaN(deadline.getTime())) return { label: "ƒêang theo d√µi", color: "bg-blue-500/10 text-blue-300 border border-blue-500/30" };

            if (deadline < today) return { label: "Qu√° h·∫°n", color: "bg-red-500/20 text-red-400 border border-red-500/50" };
            const diffTime = Math.abs(deadline - today);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            if (diffDays <= 5) return { label: "S·∫Øp ƒë·∫øn h·∫°n", color: "bg-yellow-500/20 text-yellow-400 border border-yellow-500/50" };
            return { label: "Trong h·∫°n", color: "bg-blue-500/20 text-blue-400 border border-blue-500/50" };
        }

        /* ================= T·ª∞ ƒê·ªòNG ƒêI·ªÄN B·ªò L·ªåC PH√íNG BAN ================= */
        const units = [...new Set(tasks.map(t => t.g))].sort();
        const filterSelect = document.getElementById('filterGroup');
        units.forEach(unit => {
            const opt = document.createElement('option');
            opt.value = unit;
            opt.innerText = unit;
            filterSelect.appendChild(opt);
        });

        /* ================= L·∫ÆNG NGHE S·ª∞ KI·ªÜN L·ªåC ================= */
        document.getElementById('searchBox').addEventListener('input', render);
        document.getElementById('filterGroup').addEventListener('change', render);

        /* ================= H√ÄM RENDER CH√çNH ================= */
        function render() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const groupFilter = document.getElementById('filterGroup').value;

            let totalTasks = tasks.length;
            let countChua = 0, countDang = 0, countXong = 0;
            let sourceStats = {};

            const filteredTasks = tasks.filter(t => {
                const p = getTaskStatus(t.id, t.p);
                
                if (p === "Ch∆∞a") countChua++;
                else if (p === "ƒêang") countDang++;
                else if (p === "Xong") countXong++;

                if (!sourceStats[t.g]) sourceStats[t.g] = { total: 0, done: 0 };
                sourceStats[t.g].total++;
                if (p === "Xong") sourceStats[t.g].done++;

                const matchesSearch = t.t.toLowerCase().includes(search);
                const matchesGroup = groupFilter === "all" || t.g === groupFilter;
                return matchesSearch && matchesGroup;
            });

            // 1. C·∫¨P NH·∫¨T KPI
            document.getElementById('kpis').innerHTML = `
                <div class="card p-4 rounded-xl border-l-4 border-l-blue-500">
                    <div class="text-[10px] text-blue-300 uppercase font-bold tracking-wider">T·ªïng nhi·ªám v·ª•</div>
                    <div class="text-2xl font-bold mt-1">${totalTasks}</div>
                </div>
                <div class="card p-4 rounded-xl border-l-4 border-l-red-500">
                    <div class="text-[10px] text-red-400 uppercase font-bold tracking-wider">Ch∆∞a th·ª±c hi·ªán</div>
                    <div class="text-2xl font-bold mt-1">${countChua}</div>
                </div>
                <div class="card p-4 rounded-xl border-l-4 border-l-yellow-500">
                    <div class="text-[10px] text-yellow-400 uppercase font-bold tracking-wider">ƒêang tri·ªÉn khai</div>
                    <div class="text-2xl font-bold mt-1">${countDang}</div>
                </div>
                <div class="card p-4 rounded-xl border-l-4 border-l-green-500">
                    <div class="text-[10px] text-green-400 uppercase font-bold tracking-wider">ƒê√£ ho√†n th√†nh</div>
                    <div class="text-2xl font-bold mt-1">${countXong}</div>
                </div>
            `;

            // 2. C·∫¨P NH·∫¨T BI·ªÇU ƒê·ªí DONUT
            const pctDone = Math.round((countXong / totalTasks) * 100) || 0;
            const pChua = (countChua / totalTasks) * 100;
            const pDang = (countDang / totalTasks) * 100;

            document.getElementById('donut').style.background = `conic-gradient(
                #ef4444 0% ${pChua}%, 
                #facc15 ${pChua}% ${pChua + pDang}%, 
                #22c55e ${pChua + pDang}% 100%
            )`;
            document.getElementById('percent').innerText = pctDone + "%";
            document.getElementById('count-chua').innerText = countChua;
            document.getElementById('count-dang').innerText = countDang;
            document.getElementById('count-xong').innerText = countXong;

            // 3. C·∫¨P NH·∫¨T BARS
            let barsHTML = "";
            Object.keys(sourceStats).sort().forEach(unit => {
                const stat = sourceStats[unit];
                const pct = Math.round((stat.done / stat.total) * 100) || 0;
                barsHTML += `
                    <div>
                        <div class="flex justify-between text-xs mb-1 font-semibold">
                            <span>${unit}</span>
                            <span class="text-blue-300">${stat.done}/${stat.total} (${pct}%)</span>
                        </div>
                        <div class="w-full bg-blue-900/40 h-2 rounded-full overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-green-400 h-full rounded-full transition-all duration-700" 
                                 style="width: ${pct}%"></div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('bars').innerHTML = barsHTML;

            // 4. V·∫º B·∫¢NG
            let tableHTML = "";
            filteredTasks.forEach((task, index) => {
                const p = getTaskStatus(task.id, task.p);
                const st = getDeadlineStatus(task.d, p);

                // ƒê·ªãnh d·∫°ng ng√†y hi·ªÉn th·ªã dd/mm/yyyy
                const dateObj = new Date(task.d);
                const dateDisplay = isNaN(dateObj) ? task.d : `${dateObj.getDate().toString().padStart(2,'0')}/${(dateObj.getMonth()+1).toString().padStart(2,'0')}/${dateObj.getFullYear()}`;

                tableHTML += `
                    <tr class="task-row border-b border-blue-900/50 hover:bg-blue-800/20 transition-colors" style="animation-delay: ${index * 0.02}s">
                        <td class="p-4 text-center text-blue-400 text-xs font-mono">${task.id}</td>
                        <td class="p-4 font-semibold text-blue-200 text-xs">${task.g}</td>
                        <td class="p-4 leading-relaxed">${task.t}</td>
                        <td class="p-4 text-center text-xs font-mono text-blue-300">${dateDisplay}</td>
                        <td class="p-4 text-center">
                            <select onchange="updateTaskStatus(${task.id}, this.value)" 
                                    class="text-[10px] font-bold p-1 px-2 rounded cursor-pointer w-full uppercase border border-blue-700 hover:border-blue-500 focus:border-yellow-400 transition-colors">
                                <option value="Ch∆∞a" ${p==="Ch∆∞a"?'selected':''}>Ch∆∞a</option>
                                <option value="ƒêang" ${p==="ƒêang"?'selected':''}>ƒêang</option>
                                <option value="Xong" ${p==="Xong"?'selected':''}>Xong</option>
                            </select>
                        </td>
                        <td class="p-4 text-center">
                            <span class="px-2 py-1 rounded-full text-[9px] font-bold uppercase tracking-tighter ${st.color} block text-center min-w-[80px]">
                                ${st.label}
                            </span>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('tableBody').innerHTML = tableHTML;
            document.getElementById('noResults').classList.toggle('hidden', filteredTasks.length > 0);
        }

        window.onload = render;
    </script>
</body>
</html>
