<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IOC Điều Hành Nhiệm Vụ - KH&CN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        :root {
            --bg-deep: #071028;
            --card-bg: #0f1c3f;
            --border-blue: #1e3a8a;
            --accent-yellow: #facc15;
        }

        body {
            background: var(--bg-deep);
            color: white;
            font-family: 'Inter', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-blue);
        }

        /* Mobile Responsive Table to Card */
        @media (max-width: 768px) {
            .responsive-table thead {
                display: none;
            }
            .responsive-table border-b {
                border-bottom: 2px solid #1e3a8a;
            }
            .task-row {
                display: block;
                margin-bottom: 1rem;
                padding: 1rem !important;
                background: #162a5a;
                border-radius: 12px;
                border: 1px solid #1e40af;
            }
            .task-cell {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px border-blue-900/30;
                width: 100% !important;
                text-align: left !important;
            }
            .task-cell::before {
                content: attr(data-label);
                font-weight: 700;
                font-size: 0.75rem;
                text-transform: uppercase;
                color: #94a3b8;
                margin-right: 1rem;
            }
            .task-cell.content-block {
                flex-direction: column;
                align-items: flex-start;
            }
            .task-cell.content-block::before {
                margin-bottom: 0.25rem;
            }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f1c3f; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e3a8a; border-radius: 10px; }

        select, input {
            background: #162a5a;
            color: white;
            border: 1px solid #1e3a8a;
            appearance: none;
        }

        .step-cv { color: #94a3b8; }
        .step-tp { color: #60a5fa; }
        .step-ld { color: #facc15; }
        .step-ngoai { color: #f472b6; }
        .step-final { color: #4ade80; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.4s ease-out forwards; }
    </style>
</head>

<body class="p-3 md:p-8">

    <!-- HEADER -->
    <header class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <h1 class="text-xl md:text-3xl font-bold text-yellow-400 uppercase tracking-tight">
                IOC Điều Hành KH&CN
            </h1>
            <p class="text-blue-300 text-xs mt-1 italic opacity-80">Giao diện tối ưu đa thiết bị (Mobile & Desktop)</p>
        </div>
        <div id="currentDate" class="text-[10px] font-mono text-blue-400 bg-blue-900/30 px-3 py-1 rounded-full border border-blue-800"></div>
    </header>

    <!-- KPI GRID -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6" id="kpis"></div>

    <!-- MAIN DASHBOARD -->
    <div class="grid lg:grid-cols-3 gap-6 mb-6">
        <!-- DONUT CHART -->
        <div class="card rounded-2xl p-5 flex flex-col items-center">
            <h2 class="text-sm mb-6 text-yellow-200 font-bold w-full uppercase tracking-widest">Tiến độ tổng thể</h2>
            <div class="relative w-40 h-40 md:w-48 md:h-48">
                <div id="donut" class="w-full h-full rounded-full transition-all duration-700 shadow-[0_0_20px_rgba(30,58,138,0.5)]"></div>
                <div class="absolute inset-0 flex flex-col justify-center items-center bg-transparent">
                    <div id="percent" class="text-3xl font-bold">0%</div>
                    <div class="text-[9px] uppercase tracking-tighter text-blue-300">Hoàn thành</div>
                </div>
            </div>
            <div class="mt-6 w-full space-y-2">
                <div class="flex justify-between items-center text-[10px] uppercase font-bold p-2 bg-blue-900/20 rounded-lg">
                    <span class="text-red-400">● Đang xử lý</span>
                    <span id="count-chua" class="text-lg">0</span>
                </div>
                <div class="flex justify-between items-center text-[10px] uppercase font-bold p-2 bg-green-900/20 rounded-lg">
                    <span class="text-green-400">● Hoàn thành</span>
                    <span id="count-xong" class="text-lg">0</span>
                </div>
            </div>
        </div>

        <!-- PROGRESS BY UNIT -->
        <div class="card rounded-2xl p-5 col-span-1 lg:col-span-2">
            <h2 class="text-sm mb-5 text-yellow-200 font-bold uppercase tracking-widest">Tiến độ theo đơn vị</h2>
            <div id="bars" class="space-y-4 custom-scrollbar max-h-[320px] overflow-y-auto pr-2"></div>
        </div>
    </div>

    <!-- SEARCH & FILTER BAR -->
    <div class="flex flex-col md:flex-row gap-3 mb-4">
        <div class="relative flex-1">
            <input type="text" id="searchBox" placeholder="Tìm tên nhiệm vụ..." class="w-full pl-4 pr-4 py-3 rounded-xl text-sm focus:ring-2 ring-blue-500">
        </div>
        <div class="flex gap-2">
            <select id="filterGroup" class="flex-1 md:w-48 px-4 py-3 rounded-xl text-sm font-semibold">
                <option value="all">Tất cả đơn vị</option>
            </select>
        </div>
    </div>

    <!-- TASK LIST -->
    <div class="card rounded-2xl overflow-hidden mb-8">
        <div class="overflow-x-auto custom-scrollbar">
            <table class="w-full text-left border-collapse responsive-table">
                <thead class="bg-blue-900/50 text-yellow-400 text-[10px] uppercase font-bold">
                    <tr>
                        <th class="p-4 w-12 text-center">STT</th>
                        <th class="p-4 w-28">Đơn vị</th>
                        <th class="p-4">Nội dung nhiệm vụ</th>
                        <th class="p-4 text-center w-28">Thời hạn</th>
                        <th class="p-4 w-52">Cập nhật tiến độ</th>
                        <th class="p-4 text-center w-28">Trạng thái</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-sm"></tbody>
            </table>
        </div>
        <div id="noResults" class="hidden text-center py-10 text-gray-500 italic">Không tìm thấy dữ liệu phù hợp</div>
    </div>

    <script>
        const tasks = [
            {id: 1, g:"CN&ĐMST", t:"Tham mưu Kế hoạch thực hiện Chiến lược phát triển KH,CN và ĐMST đến năm 2030 (QĐ 569/QĐ-TTg)", d:"2026-01-31", s:"CV"},
            {id: 2, g:"TCĐLCL", t:"Tham mưu xây dựng Chương trình hành động thực hiện Chỉ thị số 38-CT/TW của Ban Bí thư", d:"2026-01-31", s:"CV"},
            {id: 3, g:"CN&ĐMST", t:"Tham mưu xây dựng Nghị quyết Đảng bộ tỉnh về đột phá KHCN, ĐMST, CĐS", d:"2026-01-31", s:"CV"},
            {id: 4, g:"CN&ĐMST", t:"Tham mưu xây dựng Đề án thành lập Quỹ phát triển KH,CN và ĐMST tỉnh", d:"2026-01-31", s:"CV"},
            {id: 5, g:"TC-KH", t:"Báo cáo nhu cầu vốn KHCN, ĐMST, CĐS (2026-2030) gửi Bộ Tài chính", d:"2026-02-05", s:"CV"},
            {id: 6, g:"Văn phòng", t:"Tổng hợp, báo cáo tình hình thực hiện nhiệm vụ trước Tết Nguyên đán", d:"2026-02-10", s:"CV"},
            {id: 7, g:"QLKH", t:"Xác định danh mục nhiệm vụ KH&CN cấp tỉnh đặt hàng năm 2026", d:"2026-02-15", s:"CV"},
            {id: 8, g:"Văn phòng", t:"Kế hoạch thanh tra chuyên ngành về tiêu chuẩn đo lường chất lượng đợt 1", d:"2026-02-20", s:"CV"},
            {id: 9, g:"TCĐLCL", t:"Hướng dẫn các doanh nghiệp đăng ký giải thưởng Chất lượng Quốc gia", d:"2026-02-20", s:"CV"},
            {id: 10, g:"CN&ĐMST", t:"Tổ chức Hội đồng tư vấn giao trực tiếp tổ chức chủ trì nhiệm vụ KHCN", d:"2026-02-25", s:"CV"},
            {id: 11, g:"QLKH", t:"Báo cáo tình hình ứng dụng kết quả đề tài sau nghiệm thu", d:"2026-02-28", s:"CV"},
            {id: 12, g:"Văn phòng", t:"Tổ chức Hội nghị cán bộ công chức, viên chức đầu năm", d:"2026-02-28", s:"CV"},
            {id: 13, g:"TC-KH", t:"Công khai dự toán ngân sách nhà nước năm 2026", d:"2026-03-01", s:"CV"},
            {id: 14, g:"CĐS", t:"Triển khai cập nhật cơ sở dữ liệu quốc gia về KH&CN", d:"2026-03-05", s:"CV"},
            {id: 15, g:"Văn phòng", t:"Kiểm tra việc chấp hành quy định pháp luật về an toàn bức xạ hạt nhân", d:"2026-03-10", s:"CV"},
            {id: 16, g:"TCĐLCL", t:"Kiểm định phương tiện đo nhóm 2 tại các chợ, trung tâm thương mại", d:"2026-03-15", s:"CV"},
            {id: 17, g:"CN&ĐMST", t:"Xây dựng kế hoạch hỗ trợ hệ sinh thái khởi nghiệp đổi mới sáng tạo", d:"2026-03-20", s:"CV"},
            {id: 18, g:"QLKH", t:"Tổ chức nghiệm thu các đề tài KHCN cấp cơ sở đợt 1", d:"2026-03-25", s:"CV"},
            {id: 19, g:"Văn phòng", t:"Báo cáo kết quả thực hiện công tác cải cách hành chính Quý I", d:"2026-03-25", s:"CV"},
            {id: 20, g:"CĐS", t:"Đánh giá mức độ an toàn thông tin mạng trong cơ quan", d:"2026-03-30", s:"CV"},
            {id: 21, g:"QLKH", t:"Phê duyệt thuyết minh đề tài KHCN cấp tỉnh thực hiện từ năm 2026", d:"2026-03-31", s:"CV"},
            {id: 22, g:"TCĐLCL", t:"Tổng kết chương trình đảm bảo đo lường tại doanh nghiệp", d:"2026-03-31", s:"CV"},
            {id: 23, g:"CN&ĐMST", t:"Phát động cuộc thi Khởi nghiệp đổi mới sáng tạo tỉnh năm 2026", d:"2026-04-01", s:"CV"},
            {id: 24, g:"TC-KH", t:"Báo cáo tình hình giải ngân vốn đầu tư công Quý I/2026", d:"2026-04-05", s:"CV"},
            {id: 25, g:"Văn phòng", t:"Tiếp công dân định kỳ và giải quyết khiếu nại tố cáo", d:"2026-04-10", s:"CV"},
            {id: 26, g:"Văn phòng", t:"Kế hoạch tổ chức các hoạt động chào mừng ngày KH&CN Việt Nam 18/5", d:"2026-04-15", s:"CV"},
            {id: 27, g:"QLKH", t:"Kiểm tra tiến độ thực hiện các đề tài, dự án chuyển tiếp", d:"2026-04-20", s:"CV"},
            {id: 28, g:"TCĐLCL", t:"Tổ chức tập huấn nghiệp vụ về Tiêu chuẩn Đo lường Chất lượng", d:"2026-04-25", s:"CV"},
            {id: 29, g:"CĐS", t:"Tạo lập sổ quản lý văn bản đi, đến trong công tác văn thư trên hệ thống VBDH", d:"2026-02-13", s:"CV"},
            {id: 30, g:"Văn phòng", t:"Tham gia thực hiện chế độ báo cáo Tết", d:"2026-02-22", s:"CV"},
            {id: 31, g:"CĐS", t:"Tham mưu triển khai thực hiện Kế hoạch số 04-KH/BCĐTW", d:"2026-02-24", s:"CV"},
            {id: 32, g:"Văn phòng", t:"Kế hoạch kiểm soát TTHC, thực hiện cơ chế một cửa năm 2026", d:"2026-02-26", s:"CV"},
            {id: 33, g:"TC-KH", t:"Phương án sắp xếp sở hữu, tài sản công nghiệp sau sắp xếp", d:"2026-02-28", s:"CV"},
            {id: 34, g:"Văn phòng", t:"Rà soát, điều chỉnh Nghị quyết, Chương trình hành động (Đại hội XIV)", d:"2026-03-31", s:"CV"},
            {id: 35, g:"Văn phòng", t:"Điều chỉnh, bổ sung Quyết định của Sở năm 2026", d:"2026-03-31", s:"CV"},
            {id: 36, g:"Văn phòng", t:"Chỉ đạo nhà mạng tuyên truyền về phòng cháy chữa cháy tập trung", d:"2026-03-31", s:"CV"},
            {id: 37, g:"Văn phòng", t:"Báo cáo công tác thanh tra Quý I/2026", d:"2026-03-20", s:"CV"},
            {id: 38, g:"CN&ĐMST", t:"Đề xuất đặt hàng nhiệm vụ thuộc Chương trình nông thôn miền núi", d:"2026-03-25", s:"CV"},
            {id: 39, g:"QLKH", t:"Họp Hội đồng KHCN tỉnh phiên thứ nhất năm 2026", d:"2026-03-30", s:"CV"},
            {id: 40, g:"CĐS", t:"Báo cáo kết quả chuyển đổi số 3 tháng đầu năm 2026", d:"2026-03-31", s:"CV"}
        ];

        const steps = [
            {id: "CV", label: "CV đang thực hiện", class: "step-cv"},
            {id: "TP", label: "Trưởng phòng duyệt", class: "step-tp"},
            {id: "PGD", label: "Lãnh đạo Sở duyệt", class: "step-ld"},
            {id: "GOP_Y", label: "Gửi góp ý Sở Ngành", class: "step-ngoai"},
            {id: "VP_UB", label: "VP UBND tỉnh xử lý", class: "step-ngoai"},
            {id: "VP_TU", label: "VP Tỉnh ủy xử lý", class: "step-ngoai"},
            {id: "DONE", label: "Hoàn thành/Ban hành", class: "step-final"}
        ];

        function getTaskStep(id, defaultVal) {
            return localStorage.getItem('task_step_v5_' + id) || defaultVal;
        }

        function updateTaskStep(id, newStep) {
            localStorage.setItem('task_step_v5_' + id, newStep);
            render();
        }

        function render() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const groupFilter = document.getElementById('filterGroup').value;
            let totalTasks = tasks.length;
            let countXong = 0;
            let sourceStats = {};

            const filteredTasks = tasks.filter(t => {
                const stepId = getTaskStep(t.id, t.s);
                if (stepId === "DONE") countXong++;
                if (!sourceStats[t.g]) sourceStats[t.g] = { total: 0, done: 0 };
                sourceStats[t.g].total++;
                if (stepId === "DONE") sourceStats[t.g].done++;
                return t.t.toLowerCase().includes(search) && (groupFilter === "all" || t.g === groupFilter);
            });

            // Update KPI
            document.getElementById('kpis').innerHTML = `
                <div class="card p-3 rounded-xl border-l-4 border-l-blue-500"><div class="text-[9px] text-blue-300 uppercase font-bold">Tổng số</div><div class="text-xl font-bold">${totalTasks}</div></div>
                <div class="card p-3 rounded-xl border-l-4 border-l-red-500"><div class="text-[9px] text-red-400 uppercase font-bold">Đang xử lý</div><div class="text-xl font-bold">${totalTasks - countXong}</div></div>
                <div class="card p-3 rounded-xl border-l-4 border-l-green-500"><div class="text-[9px] text-green-400 uppercase font-bold">Đã xong</div><div class="text-xl font-bold">${countXong}</div></div>
                <div class="card p-3 rounded-xl border-l-4 border-l-yellow-500"><div class="text-[9px] text-yellow-400 uppercase font-bold">Tỷ lệ</div><div class="text-xl font-bold">${Math.round((countXong/totalTasks)*100)}%</div></div>
            `;

            // Update Donut
            const pDone = (countXong / totalTasks) * 100;
            document.getElementById('donut').style.background = `conic-gradient(#22c55e 0% ${pDone}%, #1e3a8a ${pDone}% 100%)`;
            document.getElementById('percent').innerText = Math.round(pDone) + "%";
            document.getElementById('count-chua').innerText = totalTasks - countXong;
            document.getElementById('count-xong').innerText = countXong;

            // Update Bars
            let barsHTML = "";
            Object.keys(sourceStats).sort().forEach(unit => {
                const stat = sourceStats[unit];
                const pct = Math.round((stat.done / stat.total) * 100) || 0;
                barsHTML += `<div><div class="flex justify-between text-[10px] mb-1 font-bold"><span>${unit}</span><span>${stat.done}/${stat.total}</span></div><div class="w-full bg-blue-900/40 h-1.5 rounded-full overflow-hidden"><div class="bg-blue-500 h-full" style="width: ${pct}%"></div></div></div>`;
            });
            document.getElementById('bars').innerHTML = barsHTML;

            // Update Table
            let tableHTML = "";
            filteredTasks.forEach((task, index) => {
                const currentStepId = getTaskStep(task.id, task.s);
                const isDone = currentStepId === "DONE";
                const deadline = new Date(task.d);
                const isLate = !isDone && deadline < new Date();
                
                tableHTML += `
                    <tr class="task-row border-b border-blue-900/30 hover:bg-blue-800/10 transition-colors animate-slide" style="animation-delay: ${index * 0.05}s">
                        <td class="p-4 text-center text-blue-400 font-mono text-xs task-cell" data-label="STT">${task.id}</td>
                        <td class="p-4 font-bold text-blue-200 text-[10px] task-cell" data-label="Đơn vị">${task.g}</td>
                        <td class="p-4 leading-relaxed text-sm task-cell content-block" data-label="Nội dung">${task.t}</td>
                        <td class="p-4 text-center text-xs font-mono task-cell ${isLate ? 'text-red-400 font-bold' : 'text-blue-300'}" data-label="Thời hạn">${task.d.split('-').reverse().join('/')}</td>
                        <td class="p-4 text-center task-cell" data-label="Cập nhật">
                            <select onchange="updateTaskStep(${task.id}, this.value)" class="text-[11px] font-bold p-2.5 rounded-lg w-full bg-[#071028] border border-blue-800">
                                ${steps.map(s => `<option value="${s.id}" ${currentStepId === s.id ? 'selected' : ''} class="${s.class}">${s.label}</option>`).join('')}
                            </select>
                        </td>
                        <td class="p-4 text-center task-cell" data-label="Trạng thái">
                            <span class="px-3 py-1 rounded-full text-[9px] font-bold uppercase ${isDone ? 'bg-green-500/20 text-green-400 border border-green-500/50' : isLate ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'bg-blue-500/10 text-blue-400 border border-blue-500/30'} block w-full">
                                ${isDone ? 'Xong' : isLate ? 'Trễ' : 'Đang xử lý'}
                            </span>
                        </td>
                    </tr>`;
            });
            document.getElementById('tableBody').innerHTML = tableHTML;
            document.getElementById('noResults').classList.toggle('hidden', filteredTasks.length > 0);
        }

        // Setup filters
        const units = [...new Set(tasks.map(t => t.g))].sort();
        const filterSelect = document.getElementById('filterGroup');
        units.forEach(unit => {
            const opt = document.createElement('option');
            opt.value = unit;
            opt.innerText = unit;
            filterSelect.appendChild(opt);
        });

        document.getElementById('searchBox').addEventListener('input', render);
        document.getElementById('filterGroup').addEventListener('change', render);
        document.getElementById('currentDate').innerText = "Hôm nay: " + new Date().toLocaleDateString('vi-VN');
        
        window.onload = render;
    </script>
</body>
</html>
