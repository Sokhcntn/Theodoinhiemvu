<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Theo dõi nhiệm vụ KH,CN</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0b132b; color:white; }
.card { background:#1c2541; }
.bad{background:#ff4d4f;}
.warn{background:#facc15;color:black;}
.good{background:#22c55e;}
</style>
</head>

<body class="p-8">

<h1 class="text-3xl font-bold mb-6 text-yellow-300">
THEO DÕI THỰC HIỆN NHIỆM VỤ KH,CN – ĐMST
</h1>

<!-- DASHBOARD 3 TRẠNG THÁI -->
<!-- DASHBOARD HÌNH TRÒN -->
<div class="flex flex-col md:flex-row items-center gap-12 mb-10">

  <div class="text-center">
    <div id="donutChart"
         class="w-64 h-64 rounded-full mx-auto shadow-2xl"
         style="background:#3a506b">
    </div>
    <div class="mt-4 text-lg font-bold text-yellow-200">
      Tổng thể tiến độ
    </div>
  </div>

  <div class="space-y-4 text-lg">
    <div class="flex items-center gap-3">
      <div class="w-5 h-5 bg-red-500"></div>
      Chưa thực hiện: <b id="txtA"></b>
    </div>

    <div class="flex items-center gap-3">
      <div class="w-5 h-5 bg-yellow-400"></div>
      Đang thực hiện: <b id="txtB"></b>
    </div>

    <div class="flex items-center gap-3">
      <div class="w-5 h-5 bg-green-500"></div>
      Đã xong: <b id="txtC"></b>
    </div>
  </div>

</div>

</div>

<!-- LỌC THEO NHÓM -->
<div class="mb-6">
<b>Lọc theo nhóm nhiệm vụ:</b>
<div id="groupFilter" class="mt-2"></div>
</div>

<table class="w-full text-sm">
<thead class="bg-yellow-400 text-black">
<tr>
<th>Nhóm</th>
<th>Nhiệm vụ</th>
<th>Thời hạn</th>
<th>Tiến độ</th>
<th>Trạng thái</th>
</tr>
</thead>
<tbody id="taskTable"></tbody>
</table>

<script>

/* ================= DỮ LIỆU GỐC ================= */
const tasks = [
{group:"Chỉ đạo Tỉnh ủy",task:"Xây dựng Kế hoạch thực hiện Chiến lược KH,CN đến 2030",deadline:"2026-01-31"},
{group:"UBND giao trực tiếp",task:"Thành lập Trung tâm Đổi mới sáng tạo",deadline:"2026-03-30"},
{group:"UBND giao trực tiếp",task:"Thành lập Quỹ phát triển KH,CN",deadline:"2026-06-30"},
{group:"Phối hợp liên ngành",task:"Phát triển kinh tế số GRDP",deadline:"2026-12-31"},
{group:"Triển khai NQ57",task:"Chuyển đổi số cơ quan nhà nước",deadline:"2026-12-31"},
{group:"Chiến lược 2030",task:"Ứng dụng AI, IoT trong sản xuất",deadline:"2030-12-31"}
];

/* ================= LƯU TRẠNG THÁI ================= */
function getProgress(id){
return localStorage.getItem(id) || "Chưa thực hiện";
}

function setProgress(id,value){
localStorage.setItem(id,value);
render();
}

/* ================= TÍNH TRẠNG THÁI ================= */
function calcStatus(deadline,progress){
const now=new Date();
const d=new Date(deadline);

if(progress==="Đã xong") return {text:"Đã hoàn thành",cls:"good"};

if(now>d) return {text:"Quá hạn",cls:"bad"};

return {text:"Chưa đến hạn",cls:"warn"};
}

/* ================= RENDER ================= */
function render(){

const table=document.getElementById("taskTable");
table.innerHTML="";

let sum={a:0,b:0,c:0};

tasks.forEach((t,i)=>{

if(!selectedGroups.has(t.group)) return;

const progress=getProgress(i);
const status=calcStatus(t.deadline,progress);

if(progress==="Chưa thực hiện") sum.a++;
if(progress==="Đang thực hiện") sum.b++;
if(progress==="Đã xong") sum.c++;

table.innerHTML+=`
<tr class="card">
<td>${t.group}</td>
<td>${t.task}</td>
<td>${t.deadline}</td>

<td>
<select onchange="setProgress(${i},this.value)" class="text-black">
<option ${progress==="Chưa thực hiện"?"selected":""}>Chưa thực hiện</option>
<option ${progress==="Đang thực hiện"?"selected":""}>Đang thực hiện</option>
<option ${progress==="Đã xong"?"selected":""}>Đã xong</option>
</select>
</td>

<td class="${status.cls} text-center">${status.text}</td>
</tr>`;
});

renderSummary(sum);
}

/* ================= DASHBOARD ================= */
function renderSummary(s){
document.getElementById("summary").innerHTML=`
<div class="card p-4 text-center">Chưa thực hiện<br><b>${s.a}</b></div>
<div class="card p-4 text-center">Đang thực hiện<br><b>${s.b}</b></div>
<div class="card p-4 text-center">Đã xong<br><b>${s.c}</b></div>
`;
}

/* ================= FILTER NHÓM ================= */
const groups=[...new Set(tasks.map(t=>t.group))];
let selectedGroups=new Set(groups);

const filterDiv=document.getElementById("groupFilter");

groups.forEach(g=>{
filterDiv.innerHTML+=`
<label class="mr-4">
<input type="checkbox" checked onchange="toggleGroup('${g}',this.checked)"> ${g}
</label>`;
});

function toggleGroup(g,checked){
checked?selectedGroups.add(g):selectedGroups.delete(g);
render();
}

/* ================= INIT ================= */
render();

</script>
</body>
</html>
